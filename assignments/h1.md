# h1 - raportti

Yleistiedot
Kone
Tehtävänanto
Aika: 31.3.2025 kl. 14:00

## x) Tiivistelmät

## a) Debian 12 asennus

## b) Asenna Salt (salt-minion) Linuxille (uuteen virtuaalikoneeseesi).

### Tarkasta että oikea järjestelmä on asennettu.
<pre>
lsb_release -a 
</pre>

Tulos: No LSB modules are available.
Distributor ID:	Debian
Description:	Debian GNU/Linux 12 (bookworm)
Release:	12
Codename:	bookworm

### Asenna salt
<pre>
$ mkdir -p /etc/apt/keyrings
$ curl -fsSL https://packages.broadcom.com/artifactory/api/security/keypair/SaltProjectKey/public | sudo tee /etc/apt/keyrings/salt-archive-keyring.pgp
$ curl -fsSL https://github.com/saltstack/salt-install-guide/releases/latest/download/salt.sources | sudo tee /etc/apt/sources.list.d/salt.sources  
</pre>

Tulos: curl -fsSL https://github.com/saltstack/salt-install-guide/releases/latest/download/salt.sources | sudo tee /etc/apt/sources.list.d/salt.sources
bash: curl: command not found

Korjataan ongelma asentamalla "curl" komento
<pre>
$ sudo apt update 
$ sudo apt install curl -y
</pre>

### Asenna salt-minion

<pre>
$ sudo apt update
$ sudo apt install salt-minion 
</pre>

Tarkasta versio:

<pre>
$ salt-call --version  
</pre>

Tulos: salt-call 3007.1 (Chlorine)

## c) Viisi tärkeintä. Näytä Linuxissa esimerkit viidestä tärkeimmästä Saltin tilafunktiosta: pkg, file, service, user, cmd. Analysoi ja selitä tulokset.

### 1. pkg 

Toimintoa käytetään pakettien manipulointiin. Yleiset komennot ovat prosessien asennus, poistaminen, päivittäminen sekä konfigurointi. Alla esimerkki jossa prosessi nimeltään "tree" asennettiin ja poistettiin. 

Asennus:

<pre>
$ sudo salt-call --local -l info state.single pkg.installed tree
</pre>

Kuvasta näemme minkä funktion suoritimme sekä sen tuloksen. Kun katsomme muutoksia (changes) näemme, että asensimme version 2.1.0-1, järjestelmään jossa ei aikasemmin ollut kyseistä prosessia. 

![pkg-installed](/assignments/img/pkg-installed.png)

Poistaminen:

<pre>
$ sudo salt-call --local -l info state.single pkg.removed tree  
</pre>

Poistamisen jälkeen näemme samat tiedot. Kuitenkin nyt funktio poisti prosessin ja muutoksista näemme, että postimme version 2.1.0-1, eikä uutta asennettu tilalle. 

![pkg-installed](/assignments/img/pkg-removed.png)

### 2. file 

Toiminnolla voimme luoda, poistaa sekä muokata tiedostoja suoraan komentoriviä käyttäen. 

Esimerkki
Luodaan tiedosto - määritetään kohteeksi työpöytä ja annetaan nimeksi "testfile"

<pre>
  $ sudo salt-call --local -l info state.single file.managed ~/Desktop/tesfile
</pre>

![file-create](/assignments/img/file-new.png)

Muokataan tiedostoa lisäämällä siihen sisältö "hello world"

<pre>
  $ sudo salt-call --local -l info state.single file.managed ~/Desktop/tesfile contents="hello world"
</pre>

![file-contents](/assignments/img/file-contents.png)

### 3. service 

Käytetään prosessien hallintaan. Teemme testin käyttäen apache2 prosessia.

Lähtötila: apache2 on asennettu ja käytössä. Nyt haluamme pysäyttää prosessin. Haluamme myös että se ei käynnisty automaattisesti uudelleen. 
Tähän käytämme service komentoa:

<pre>
$ sudo salt-call --local -l info state.single service.dead apache2 enable=False 
</pre>

![service-shutdown-apache2](/assignments/img/service-shutdown-apache2.png)

Nyt näemme että ajoimme service.dead funktion joka onnistui.
Prosessi on pysäytetty ja automaattikäynnistys on poissa päältä.
Järjestelmässä tapahtui onnistuneesti yksi muutos. 

### 4. user

Komentoa käytetään käyttäjien hallintaan. Nyt hyödynnämme sitä uuden käyttäjän luomiseen.

<pre>
$ sudo salt-call --local -l info state.single user.present mika1
</pre>

![new-user](/assignments/img/new-user.png)

Uusi käyttäjä on luotu onnistuneesti. Tarvittavat konfiguroinnit käyttäjälle on tehty
Järjestelmässä tapahtui yksi onnistunut muutos. 

### 5. cmd



## d) Idempotentti. Anna esimerkki idempotenssista. Aja 'salt-call --local' komentoja, analysoi tulokset, selitä miten idempotenssi ilmenee.


## Lähdeluettelo: 
https://www.debian.org/distrib/
https://docs.saltproject.io/salt/install-guide/en/latest/topics/install-by-operating-system/linux-deb.html
https://terokarvinen.com/2021/install-debian-on-virtualbox/#debian-on-mac-m1-or-m2
https://linuxcommandlibrary.com/man/pkg
https://linuxcommandlibrary.com/man/file
https://linuxcommandlibrary.com/man/service

